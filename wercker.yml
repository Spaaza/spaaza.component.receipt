box: node

build:
  steps:
    - script:
        name: setting NODE_ENV
        code: |
          export NODE_ENV='$NODE_ENV'
    - npm-install
    - script:
        name: build
        code: |
          npm install -g webpack
          webpack -p --define process.env.NODE_ENV='\"production\"' --progress --colors
  after-steps:
      - slack-notifier:
          url: $SLACK_WEBHOOK_URL


deploy-s3:
  steps:
    - s3sync:
      key_id: $AWS_ACCESS_KEY_ID
      key_secret: $AWS_SECRET_ACCESS_KEY
      bucket_url: $AWS_BUCKET_URL
      source_dir: dist/
      opts: --acl-public --add-header=Cache-Control:max-age=3600 --cf-invalidate
  after-steps:
      - slack-notifier:
          url: $SLACK_WEBHOOK_URL
