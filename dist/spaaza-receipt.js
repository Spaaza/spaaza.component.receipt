!function(){"use strict";function e(e,t){for(var a=[],n=2;n<arguments.length;n++)a[n-2]=arguments[n];var r=a.length?(l=[]).concat.apply(l,a):null;if("string"==typeof e)return{nodeName:e,attributes:t,children:r};var i=t;return r&&(i.children=r),e(i);var l}function t(e){if(!e)return null;if("string"==typeof e){var a=e.replace(/%u([0-9a-fA-F]{4})/g,function(e,t){var a=document.createElement("span");return a.innerHTML="&#x"+t,a.innerText});return document.createTextNode(a)}if("number"==typeof e)return document.createTextNode(e+"");var n=document.createElement(e.nodeName);return e.attributes&&Object.keys(e.attributes).forEach(function(t){var a=e.attributes[t];if("function"!=typeof a)if("object"!=typeof a)"string"!=typeof a||n.setAttribute(t,a);else{var r=!0,i=Object.keys(a).map(function(e){var t=a[e];if(!0===t)return e;if(!1!==t&&null!==t&&void 0!==t)return r=!1,e+": "+t}).filter(function(e){return!!e}).join(r?" ":", ");n.setAttribute(t,i)}else{var l=t.substr(2).toLowerCase();n.addEventListener(l,a)}}),e.children&&e.children.forEach(function(e){var a=t(e);a&&n.appendChild(a)}),n}function a(t){return e("table",{class:"divider-wrapper"},e("tr",null,e("td",{class:"divider-spacer"},e("table",{class:"divider",cellPadding:0,cellSpacing:0},e("tr",null,e("td",null))))))}function n(){Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null})}function r(e){var t=function(t){var a=e.querySelector("script[data-"+t+"]");if(a&&a.textContent)try{return JSON.parse(a.textContent)}catch(e){console.warn("Failed to parse "+t+" data: ",e)}},a=e.getAttribute("language")||"",n=u(a),r=t("strings"),i=r?f(n,r):n,l=t("receipt");if(l){var o=Math.max(0,parseFloat(e.getAttribute("walletpointsratio")||"")||0);l.wallet_points_ratio=o;var s=e.getAttribute("customnotes")||"";l.custom_notes=s;var c=e.getAttribute("environment")||"";l.environment=c;var p=!0;e.getAttribute("showpoints")&&(p="true"===e.getAttribute("showpoints")),l.show_points=p}return l.download_url=e.getAttribute("download-url")||"https://services-prod.spaaza.com",{receipt:l,langCode:n.langCode,strings:i}}function i(a,n){var i,l=r(a);if(l.receipt){var o=b(l.strings,{$GIVEN_NAME:l.receipt.shopper.first_name,$FAMILY_NAME:l.receipt.shopper.last_name,$CHAIN_NAME:l.receipt.chain.name});i=F(l.receipt,o,l.langCode)}else console.warn("Could not render receipt",l),i=G({},l.strings,l.langCode);n.appendChild(t(e("div",{class:"spaaza-receipt"},e("style",null,W),i)))}function l(e){if(!e.querySelector(".receipt-body")){var t=document.createElement("div");t.className="receipt-body",e.appendChild(t),i(e,t)}}function o(){n();for(var e=0,t=[].slice.call(document.querySelectorAll("spaaza-receipt"),0);e<t.length;e++)l(t[e]);s()}function s(){if("MutationObserver"in window){new MutationObserver(function(e){for(var t=0,a=e;t<a.length;t++)for(var n=a[t],r=0,i=Array.prototype.slice.call(n.addedNodes,0);r<i.length;r++){var o=i[r];o.nodeType===Node.ELEMENT_NODE&&"spaaza-receipt"===o.nodeName.toLowerCase()&&l(o)}}).observe(document,{childList:!0,subtree:!0})}}var c={"en-GB":{langCode:"en-GB",brand:{title:"Your Receipt",message:"Hi there $GIVEN_NAME, thanks for your purchase!"},details:{message:"Your order details from $CHAIN_NAME:",charged:"CHARGED","order-number":"Order number",date:"Date",payment:"Payment method","employee-name":"Employee"},lineitems:{name:"Name",quantity:"Qty",price:"Price"},taxes:{"tax-rate":"VAT Rate","order-value":"Order value","tax-value":"VAT"},paymentmethods:{},totals:{subtotal:"Subtotal",total:"Total",voucher:"Voucher"},wallet:{earned:"earned",spent:"spent","new-balance":"Your new balance"},download:{label:"Download your PDF Receipt"},store:{message:"Thank you!"},error:{message:"There was a problem showing this receipt."}},"nl-NL":{langCode:"nl-NL",brand:{title:"Jouw Bon",message:"Bedankt voor je aankoop, $GIVEN_NAME!"},details:{message:"Informatie over je aankoop bij $CHAIN_NAME:",charged:"In rekening gebracht","order-number":"Bestellingsnummer",date:"Datum",payment:"Betaalmethode","employee-name":"Werknemer"},lineitems:{name:"Naam",quantity:"Aantal",price:"Prijs"},taxes:{"tax-rate":"BTW %","order-value":"Waarde","tax-value":"BTW"},paymentmethods:{},totals:{subtotal:"Subtotaal",total:"Totaal",voucher:"Kortingsbon"},wallet:{earned:"verdiend",spent:"uitgegeven","new-balance":"Jouw nieuwe totaal"},download:{label:"Download je bon als PDF"},store:{message:"Hartelijk bedankt!"},error:{message:"Er was een probleem met het tonen van deze bon."}}},p=function(e){var t="en-GB";return"nl"!==(e=e.toLowerCase().trim())&&"nl-"!==e.substr(0,3)&&"nl_"!==e.substr(0,3)||(t="nl-NL"),t},u=function(e){return c[p(e)]},d=function(e,t){var a={};for(var n in e)e.hasOwnProperty(n)&&(a[n]=t(e[n],n));return a},m=function(e,t){var a={};for(var n in e)e.hasOwnProperty(n)&&"object"==typeof e[n]&&(a[n]=t(e[n],n));return a},g=function(e,t){return m(e,function(e,a){return d(e,t)})},h=function(e,t){var a=e;for(var n in t)t.hasOwnProperty(n)&&(a=a.replace(new RegExp(function(e){return e.replace(/[\-\[\]\{\}\(\)\*\+\?\.\\\^\$\|\#]/g,function(e){return"\\"+e})}(n),"g"),t[n]));return a},b=function(e,t){return g(e,function(e){return h(e,t)})},f=function(e,t){return m(e,function(e,a){var n=t[a];return d(e,function(e,t){return n&&t in n?n[t]:e})})},y=function(e,t){var a="pts"===t,n=a?0:2,r=!a,i=(+e).toFixed(n);return r?t+" "+i:i+" "+t},v=function(e,t){return(e||[]).map(function(e){return e[t]}).reduce(function(e,t){return e+t},0)},w=function(e,t,a,n){return(e||[]).filter(function(e){return e[a]===n}).map(function(e){return e[t]}).reduce(function(e,t){return e+t},0)},z=function(t,a){return e("table",null,t.logoURL&&e("tr",null,e("td",null,e("img",{class:"brand_logo",src:t.logoURL}))),a.title&&e("tr",null,e("td",null,e("h1",null,a.title))),a.message&&e("tr",null,e("td",null,e("p",null,a.message))))},_=function(e,t){return z({logoURL:e.chain.logo_url},t.brand)},x=function(t,a,n){var r=a.message?e("tr",null,e("td",{colSpan:2},a.message)):null,i=t.total?e("tr",{class:"receipt-strong"},e("td",{class:""},a.charged),e("td",{class:"align-right"},y(t.total,t.currencySymbol))):null,l=t.retailerCode?e("tr",null,e("td",{class:""},a["order-number"]),e("td",{class:"align-right"},"#",t.retailerCode)):null,o=t.employeeName?e("tr",null,e("td",{class:""},a["employee-name"]),e("td",{class:"align-right"},t.employeeCode)):null;return e("table",null,r,i,l,t.date?e("tr",null,e("td",{class:""},a.date),e("td",{class:"align-right"},new Date(t.date).toLocaleString(n))):null,o)},k=function(e,t,a){return x({total:e.total_value,date:e.timestamp,retailerCode:e.retailer_basket_code,currencySymbol:e.chain.currency_symbol,employeeName:e.employee.name,employeeCode:e.employee.code},t.details,a)},E=function(t,a){if(!t.lineitems||!t.lineitems.length)return null;var n=t.currencySymbol;return e("table",{class:"receipt-lineitems"},e("tr",null,e("th",{class:"align-left"},a.name),e("th",{class:"align-center"},a.quantity),e("th",{class:"align-right"},a.price)),t.lineitems.map(function(t){var a=t.original_price>t.sale_price;return e("tr",{class:"line-item"},e("td",{class:"align-left"},e("div",{class:"line-item-name"},t.description||t.barcode)),e("td",{class:"align-center"},t.quantity),e("td",{class:"align-right"},e("span",{class:{"receipt-original-price":!0,"receipt-line-through":a}},y(t.original_price,n)),e("span",{class:"receipt-sale-price receipt-strong"},y(t.sale_price,n))))}))},C=function(e,t){return E({lineitems:e.line_items,currencySymbol:e.chain.currency_symbol},t.lineitems)},N=function(t,a,n){if(!t.taxes||!t.taxes.length)return null;var r=t.currencySymbol;return e("table",{class:"receipt-linetaxes"},e("tr",null,e("th",{class:"align-left"},a["tax-rate"]),e("th",{class:"align-center"},a["order-value"]),e("th",{class:"align-right"},a["tax-value"])),t.taxes.map(function(t){return e("tr",{class:"tax-line"},e("td",{class:"var-rate align-left"},Math.round(100*t.rate),"%"),e("td",{class:"order-value align-center"},y(t.order_value,r)),e("td",{class:"vat align-right"},y(t.tax_value,r)))}))},S=function(e,t,a){return N({taxes:e.tax_lines,currencySymbol:e.chain.currency_symbol},t.taxes)},A=function(t,a,n){if(!t.paymentMethods||!t.paymentMethods.length)return null;var r=t.currencySymbol;return e("table",{class:"receipt-paymentmethods"},t.paymentMethods.map(function(t){return e("tr",{class:"payment-method"},e("td",{class:"var-rate align-left"},t.payment_method),e("td",{class:"order-value align-right"},y(t.payment_amount,r)))}))},M=function(e,t,a){return A({paymentMethods:e.payment_methods,currencySymbol:e.chain.currency_symbol},t.paymentmethods)},L=function(t,a){return e("table",{class:"receipt-totals"},t.basketVouchers.map(function(n){return e("tr",null,e("td",null,a.voucher,": ",n.campaign_title),e("td",{align:"right",class:"voucher"},y(-1*n.amount,t.currencySymbol)))}),e("tr",{class:"receipt-subtotal"},e("td",null,a.subtotal),e("td",{class:"align-right"},y(t.subtotal,t.currencySymbol))),e("tr",{class:"receipt-strong receipt-total"},e("td",null,a.total),e("td",{class:"align-right"},y(t.total,t.currencySymbol))))},T=function(e,t){return L({total:e.total_value,subtotal:e.subtotal,loyaltyVouchersSpent:w(e.basket_vouchers,"amount","type","loyalty"),walletVouchersSpent:w(e.basket_vouchers,"amount","type","wallet"),currencySymbol:e.chain.currency_symbol,basketVouchers:e.basket_vouchers},t.totals)},j=function(t,a){var n=t.wallet,r=t.totalEarned,i=t.totalSpent,l=t.currencySymbol,o=t.showPoints;if(!n||!o||!r&&!i)return null;return e("table",{class:"receipt-wallet"},e("tr",null,e("td",{class:"receipt-strong"},n.title)),r?e("tr",null,e("td",null,n.title," ",a.earned),e("td",{align:"right"},y(r,l))):null,n.contributions.length>1&&n.contributions.map(function(t){return e("tr",null,e("td",null,"    ",t.campaign_title),e("td",{align:"right"},y(t.amount,l)))}),i?e("tr",null,e("td",null,n.title," ",a.spent),e("td",{align:"right"},y(i,l))):null,e("tr",null,e("td",null,a["new-balance"]),e("td",{align:"right",class:"receipt-strong"},y(n.total,l))))},P=function(e,t){return t<=0?e:Math.round(e*t)},O=function(e,t){return j({wallet:e.monetary_wallet&&{title:e.monetary_wallet.title,total:P(e.monetary_wallet.total,e.wallet_points_ratio),contributions:e.monetary_wallet.contributions.map(function(t){return{campaign_title:t.campaign_title,amount:P(t.amount,e.wallet_points_ratio)}})},showPoints:!0,totalEarned:P(v(e.monetary_wallet?e.monetary_wallet.contributions:[],"amount"),e.wallet_points_ratio),totalSpent:P(w(e.basket_vouchers,"amount","type","wallet"),e.wallet_points_ratio),currencySymbol:e.wallet_points_ratio>0?"pts":e.chain.currency_symbol},t.wallet)},B=function(e,t){return j({wallet:e.points_wallet,showPoints:e.show_points,totalEarned:e.points_wallet&&v(e.points_wallet.contributions,"amount")||0,totalSpent:0,currencySymbol:"pts"},t.wallet)},H=function(t,a,n){return t.download_url?e("div",{class:"btn-download"},e("form",{target:"_blank",method:"POST",action:t.download_url+"/receipts/print/"+t.id+".pdf"},e("input",{type:"hidden",name:"content",value:"<b>empty</b>"})),e("a",{onClick:function(e){var t=e.target.closest("div.spaaza-receipt"),a=e.target.parentElement.querySelector("form"),n=a.querySelector('input[name="content"]');n.value="",n.value=t.outerHTML,a.submit(),e.preventDefault()}},a.download.label)):null},D=function(t,a,n){return t.name||t.address||t.postalcode||t.city||t.contact||t.email||t.website?e("table",{class:"receipt-store"},e("tr",null,e("td",{class:"align-left"},t.name&&e("div",null,t.name),t.address&&e("div",null,t.address),(t.postalcode||t.city)&&e("div",null,t.postalcode," ",t.city),t.email&&e("div",null,e("a",{href:"mailto:"+t.email},t.email)),t.website&&e("div",null,e("a",{href:t.website,target:"_blank"},t.website)),t.contact&&e("a",{href:"tel:"+t.contact},t.contact)))):null},V=function(e,t,a){var n=e.chain.business;return D({name:n.name,contact:n.phone_number,email:n.email,website:n.website_url,address:(n.address.address_1+" "+n.address.address_2+" "+n.address.address_3).trim(),postalcode:n.address.postal_code,city:n.address.towncity},t.store)},q=function(t){return t.retailerCode?"staging"===t.environment||"test01"===t.environment?e("div",{class:"content barcode"},e("div",{class:"image",title:"Barcode: "+t.retailerCode,style:"background-image: url(https://missetam-test01.spaaza.com/barcode/"+t.retailerCode+")"})):e("div",{class:"content barcode"},e("div",{class:"image",title:"Barcode: "+t.retailerCode,style:"background-image: url(https://acme-prod.spaaza.com/barcode/"+t.retailerCode+")"})):null},I=function(e,t){return q({retailerCode:e.retailer_basket_code,environment:e.environment})},R=function(t){if(!t.notes&&!t.customNotes)return null;return e("div",{class:"receipt-notes"},t.customNotes?e("p",null,t.customNotes):null,!t.notes||t.customNotes?null:e("p",null,t.notes))},$=function(e,t){return R({notes:e.notes,customNotes:e.custom_notes})},F=function(t,n,r){var i=function(e){return e(t,n,r)},l=function(t){var n=i(t);return n?e("div",null,e(a,null),n):n};return e("div",{class:"main content"},e("section",null,i(_),i(k)),e("section",null,l(C),l(S),l(T),i(M),l(O),l(B),e("div",{class:"download"},e(a,null),i(H))),e("section",null,l(V),l($),i(I)))},G=function(t,a,n){return e("div",{class:"main content"},e("p",null,a.error.message))},W='.spaaza-receipt{font-size:16px;font-family:"Helvetica Neue",Helvetica,Helvetica,Arial,sans-serif;-webkit-font-smoothing:antialiased;line-height:1.6em;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#000;text-align:left}@media print{.spaaza-receipt{font-size:7pt}.spaaza-receipt div.download{display:none}}.spaaza-receipt html#pdf{font-size:9pt}.spaaza-receipt html#pdf div.download{display:none}.spaaza-receipt section{margin:0}.spaaza-receipt a,.spaaza-receipt div,.spaaza-receipt table,.spaaza-receipt td{box-sizing:border-box}.spaaza-receipt img{-ms-interpolation-mode:bicubic;max-width:100%}.spaaza-receipt table{border-collapse:separate!important;width:100%}.spaaza-receipt table td{font-size:87%}.spaaza-receipt table th{vertical-align:top;font-size:75%;text-transform:uppercase;font-weight:400;color:#aaa}.spaaza-receipt .ExternalClass{width:100%}.spaaza-receipt .ExternalClass,.spaaza-receipt .ExternalClass div,.spaaza-receipt .ExternalClass font,.spaaza-receipt .ExternalClass p,.spaaza-receipt .ExternalClass span,.spaaza-receipt .ExternalClass td{line-height:100%}.spaaza-receipt .body{background-color:#f6f6f6;width:100%}.spaaza-receipt .container{display:block;margin:0 auto;max-width:36em;padding:.6em;width:auto}.spaaza-receipt .content{display:block;max-width:36em;margin:0 auto;padding:.6em}.spaaza-receipt .main{background:#fff;border:1px solid #e9e9e9;border-radius:3px;width:100%;padding:2em}.spaaza-receipt .wrapper{padding:2em}.spaaza-receipt .content-block{padding:0 0 2em}.spaaza-receipt .header{margin-bottom:2em;margin-top:1.5em;width:100%}.spaaza-receipt .footer{clear:both;width:100%;font-size:75%;color:#999}.spaaza-receipt .footer td{padding:2em 0}.spaaza-receipt h1,.spaaza-receipt h2,.spaaza-receipt h3,.spaaza-receipt h4{color:#111!important;font-family:inherit;font-weight:400;line-height:1.4em;margin:0;margin-bottom:2em}.spaaza-receipt h1{font-size:230%;text-transform:capitalize;font-weight:300}.spaaza-receipt h2{font-size:150%}.spaaza-receipt h3{font-size:120%}.spaaza-receipt h4{font-size:87%;font-weight:500}.spaaza-receipt p{font-family:inherit;font-weight:400;margin:0 0 1.2em 0}.spaaza-receipt a{color:#000;text-decoration:underline}.spaaza-receipt .word-wrap,.spaaza-receipt code,.spaaza-receipt pre{word-break:break-word;word-wrap:break-word;-webkit-hyphens:auto;-moz-hyphens:auto;hyphens:auto}.spaaza-receipt .divider{border-collapse:separate}.spaaza-receipt .divider-spacer{padding:1.5em 0}.spaaza-receipt .divider td{border-top:1px solid #ccc;line-height:0;font-size:0;height:1px;margin:0;padding:0}.spaaza-receipt .last{margin-bottom:0}.spaaza-receipt .first{margin-top:0}.spaaza-receipt .align-center{text-align:center}.spaaza-receipt .align-right{text-align:right}.spaaza-receipt .align-left{text-align:left}.spaaza-receipt .clear{clear:both}.spaaza-receipt .mt0{margin-top:0}.spaaza-receipt .mb0{margin-bottom:0}.spaaza-receipt .preheader{color:transparent;display:none;height:0;max-height:0;max-width:0;opacity:0;overflow:hidden;mso-hide:all;visibility:hidden;width:0}@media only screen and (max-width:620px){.spaaza-receipt table[class=body] h1,.spaaza-receipt table[class=body] h2,.spaaza-receipt table[class=body] h3,.spaaza-receipt table[class=body] h4{font-weight:600!important}.spaaza-receipt table[class=body] h1{font-size:22px!important}.spaaza-receipt table[class=body] h2{font-size:18px!important}.spaaza-receipt table[class=body] h3{font-size:16px!important}.spaaza-receipt table[class=body] .content,.spaaza-receipt table[class=body] .wrapper{padding:10px!important}.spaaza-receipt table[class=body] .container{padding:0!important;width:100%!important}.spaaza-receipt table[class=body] .btn a,.spaaza-receipt table[class=body] .btn table{width:100%!important}}.spaaza-receipt .receipt-strong{font-weight:700;text-transform:uppercase}.spaaza-receipt .receipt-total td{font-size:inherit}.spaaza-receipt .receipt-emphasis{font-style:italic}.spaaza-receipt .receipt-line-through{text-decoration:line-through}.spaaza-receipt table.receipt-lineitems td,.spaaza-receipt table.receipt-lineitems th,.spaaza-receipt table.receipt-linetaxes td,.spaaza-receipt table.receipt-linetaxes th{width:33%}.spaaza-receipt img.brand_logo{display:block;margin:3em auto;height:6em}.spaaza-receipt h1{text-align:center}.spaaza-receipt .receipt-original-price{display:none}.spaaza-receipt .receipt-original-price.receipt-line-through{display:inline;padding-right:.4em}.spaaza-receipt .btn-download{width:100%;padding-bottom:1em;background-color:#000;border-radius:.2em;text-align:center;font-family:inherit;-webkit-font-smoothing:antialiased;font-size:87%;height:45px!important;line-height:1.6em;margin:0;padding:0;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}.spaaza-receipt .btn-download a{background-color:#000;border:solid 1px #000;border-radius:.2em;color:#fff;cursor:pointer;display:inline-block;font-weight:700;margin:0;padding:.75em 1.5em;text-decoration:none;text-transform:capitalize}.spaaza-receipt .receipt-footer-message{text-align:center}.spaaza-receipt .receipt-notes p{text-align:center}.spaaza-receipt .barcode{padding:2em 0}.spaaza-receipt .barcode .image{background-position:center top;background-repeat:no-repeat;height:2.8em}';"loading"===document.readyState?document.addEventListener("readystatechange",function(){"loading"!==document.readyState&&o()}):o()}();
//# sourceMappingURL=spaaza-receipt.js.map
